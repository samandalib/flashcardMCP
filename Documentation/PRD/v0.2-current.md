# PRD ‚Äî Research Note Synthesizer (v0.2)

**Version:** v0.2 (Current Implementation)  
**Date:** January 16, 2025  
**Status:** Active Development  
**Previous Version:** [v0.1](./current.md) | [v0 Original](./v0-original.md)

## Evolution from Previous Versions

### Key Paradigm Shifts
- **From Flashcards to Notes:** Evolved from structured front/back cards to free-form Apple Notes-style rich text editing
- **From Forms to Rich Editor:** Replaced form-based input with contentEditable rich text interface
- **From Separate Components to Integrated Experience:** Unified project management with inline note editing

### Architecture Decisions Maintained
- **Express Backend:** Kept existing Express server instead of migrating to Next.js API routes
- **Supabase Integration:** Continued with Supabase for database and storage
- **React Context i18n:** Simplified internationalization without next-intl dependency

---

## 1. Overview

A lightweight research note-taking application that allows users to capture findings in free-form rich text notes, organize them into projects, and prepare them for synthesis via ChatGPT through the Model Context Protocol (MCP).

The application now functions as an Apple Notes-style editor with project organization, supporting both English and Farsi languages with proper bidirectional text support.

---

## 2. Current Goals

- **Intuitive Note Creation:** Provide an Apple Notes-like interface for capturing research findings
- **Rich Content Support:** Allow formatting, media insertion, and unlimited content per note
- **Project Organization:** Group related notes under projects for better organization  
- **Bilingual Support:** Full English/Farsi support with proper RTL/LTR text direction
- **Auto-Save:** Seamless content preservation without manual save actions
- **Future MCP Integration:** Prepare structure for ChatGPT synthesis via MCP

---

## 3. Implemented User Stories

### ‚úÖ Completed Features

1. **Create Projects:** Users can create projects with name and description
2. **Rich Text Notes:** Users can create notes with:
   - Free-form rich text editing (Apple Notes-style)
   - Bold, italic, underline formatting
   - Text alignment (left, center, right)
   - Bulleted and numbered lists
   - Image, audio, and file insertion (UI ready)
3. **Project Navigation:** Users can browse projects and navigate to detailed views
4. **Note Management:** Users can create, edit, and organize notes within projects
5. **Language Switching:** Users can toggle between English and Farsi with proper text direction
6. **Auto-Save:** Content automatically saves on input and focus loss
7. **Responsive Design:** Mobile-friendly interface across all screens

### üîÑ In Progress

1. **Media Upload:** Backend integration for actual file uploads to Supabase Storage
2. **Note Deletion:** UI and API for removing notes
3. **Search Functionality:** Find notes across projects
4. **MCP Integration:** ChatGPT synthesis capabilities

---

## 4. Current Implementation Scope

### ‚úÖ Implemented
- **Project CRUD:** Complete create, read operations with backend API
- **Note CRUD:** Create, read, update operations with rich HTML content storage
- **Rich Text Editor:** Full contentEditable implementation with toolbar
- **Bilingual Interface:** English/Farsi support with dynamic text direction
- **Database Schema:** Projects and notes tables with proper relationships
- **Auto-Save:** Debounced content persistence
- **Responsive UI:** Mobile-first design with shadcn/ui components

### üîÑ Partially Implemented
- **Media Attachments:** UI components ready, backend storage integration pending
- **Project Management:** Basic CRUD, advanced features (delete, archive) pending

### ‚è≥ Future Scope
- **MCP Server:** ChatGPT integration for research synthesis
- **Advanced Search:** Full-text search across notes
- **Export Features:** PDF, markdown, JSON export capabilities
- **Collaboration:** Multi-user project sharing
- **Version History:** Note revision tracking

---

## 5. Technical Architecture

### Frontend Stack
- **Next.js 15:** React framework with App Router
- **TypeScript:** Type-safe development
- **Tailwind CSS v4:** Modern styling framework
- **shadcn/ui:** Component library for consistent UI
- **React Context:** State management for locale and preferences

### Backend Stack
- **Express.js:** RESTful API server
- **Supabase:** PostgreSQL database with real-time capabilities
- **Node.js:** Server runtime environment

### Database Schema
```sql
-- Projects table
projects (
  id UUID PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- Notes table (evolved from cards)
notes (
  id UUID PRIMARY KEY,
  project_id UUID REFERENCES projects(id),
  title VARCHAR(200) DEFAULT 'Untitled Note',
  content TEXT, -- Rich HTML content
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

### API Endpoints
- `GET /api/projects` - List all projects
- `POST /api/projects` - Create new project
- `GET /api/projects/:id` - Get project details
- `GET /api/projects/:id/notes` - List project notes
- `POST /api/projects/:id/notes` - Create new note
- `PUT /api/notes/:id` - Update existing note
- `DELETE /api/notes/:id` - Delete note

---

## 6. User Interface Design

### Key Design Decisions
1. **Apple Notes Inspiration:** Clean, minimal interface focused on content creation
2. **Sidebar Navigation:** Project notes listed in collapsible sidebar
3. **Inline Editing:** Direct content editing without modal dialogs
4. **Contextual Toolbar:** Formatting options appear when needed
5. **Bilingual Support:** Seamless language switching with proper text direction

### Component Architecture
- **RichTextEditor:** Core contentEditable component with formatting toolbar
- **ProjectDetailPage:** Main interface with sidebar and editor
- **CreateProjectDialog:** Modal for new project creation
- **LocaleContext:** Global language and direction management
- **LanguageSwitcher:** Toggle between English and Farsi

---

## 7. Key Technical Decisions

### Rich Text Editor Implementation
- **Approach:** contentEditable with document.execCommand for formatting
- **Rationale:** Simpler than draft-js/slate, better performance, native browser behavior
- **Content Storage:** HTML strings in database TEXT fields
- **Direction Handling:** Multiple enforcement strategies for RTL/LTR support

### Internationalization Strategy
- **Approach:** React Context with localStorage persistence
- **Rationale:** Simpler than next-intl, better control over direction changes
- **Implementation:** Dynamic text direction based on locale selection

### Auto-Save Strategy
- **Triggers:** Input events, blur events, Ctrl+S keyboard shortcut
- **Debouncing:** Prevents excessive API calls during typing
- **Feedback:** Visual indicators for save status and last saved time

---

## 8. Success Metrics (Planned)

### User Engagement
- Projects created per user
- Notes created per project
- Session duration in editor
- Return usage frequency

### Technical Performance
- Auto-save response time (<500ms)
- Page load performance (Core Web Vitals)
- Error rates in rich text operations
- Cross-browser compatibility scores

### Feature Adoption
- Rich formatting usage rates
- Language switching frequency
- Media attachment usage (when implemented)
- Mobile vs desktop usage patterns

---

## 9. Future Roadmap

### Phase 1: Core Completion (Current)
- Complete media upload functionality
- Add note deletion capabilities
- Implement basic search

### Phase 2: MCP Integration
- Build MCP server for ChatGPT communication
- Create synthesis workflow UI
- Add export capabilities for synthesis results

### Phase 3: Advanced Features
- Advanced search and filtering
- Note templates and snippets
- Collaboration features
- Version history and backups

### Phase 4: Scale & Polish
- Performance optimizations
- Advanced formatting options
- Integration with external research tools
- Mobile app considerations

---

## 10. Technical Debt & Known Issues

### Resolved Issues
- ‚úÖ Text direction problems in rich text editor
- ‚úÖ DOM manipulation conflicts with React
- ‚úÖ Hydration mismatches in SSR
- ‚úÖ Environment variable configuration
- ‚úÖ Git security with exposed credentials

### Current Technical Debt
- Media insertion buttons are placeholder (no actual upload)
- Limited error handling in some edge cases
- No note deletion functionality in UI
- Basic validation, could be more comprehensive

### Future Considerations
- Consider migration to more robust rich text library if complexity grows
- Implement proper content sanitization for security
- Add offline capabilities for mobile usage
- Consider real-time collaboration features

---

*This PRD reflects the current state as of January 16, 2025, and will be updated as development progresses.*
