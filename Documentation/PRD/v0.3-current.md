# PRD â€” Research Note Synthesizer (v0.3)

**Version:** v0.3 (TabbedEditor with Auto-Save)  
**Date:** January 16, 2025  
**Status:** Active Development  
**Previous Version:** [v0.2](./v0.2-current.md) | [v0.1](./current.md) | [v0 Original](./v0-original.md)

## Evolution from Previous Versions

### Key Paradigm Shifts
- **From Rich Text Editor to Tabbed Editor:** Evolved from single contentEditable to multi-tab structured editing
- **From Manual Save to Auto-Save:** Replaced manual save button with automatic content persistence
- **From HTML Content to Structured Tabs:** Changed from free-form HTML to organized tab-based content structure

### Architecture Decisions Maintained
- **Express Backend:** Kept existing Express server instead of migrating to Next.js API routes
- **Supabase Integration:** Continued with Supabase for database and storage
- **React Context i18n:** Simplified internationalization without next-intl dependency

---

## 1. Overview

A lightweight research note-taking application that allows users to capture findings in structured tabbed notes, organize them into projects, and prepare them for synthesis via ChatGPT through the Model Context Protocol (MCP).

The application now functions as a tabbed note editor with automatic saving, supporting both English and Farsi languages with proper bidirectional text support.

---

## 2. Current Goals

- **Structured Note Creation:** Provide a tabbed interface for organizing research findings
- **Auto-Save Functionality:** Seamless content preservation without manual save actions
- **Project Organization:** Group related notes under projects for better organization  
- **Bilingual Support:** Full English/Farsi support with proper RTL/LTR text direction
- **Tab Management:** Flexible tab system with default and custom tabs
- **Future MCP Integration:** Prepare structure for ChatGPT synthesis via MCP

---

## 3. Implemented User Stories

### âœ… Completed Features

1. **Create Projects:** Users can create projects with name and description
2. **Tabbed Note Editor:** Users can create notes with:
   - **Default Tabs:** Finding, Evidence, Details
   - **Custom Tabs:** Add unlimited custom tabs
   - **Tab Management:** Delete custom tabs, reorder tabs
   - **Auto-Save:** Content automatically saves after 2 seconds of inactivity
   - **Visual Feedback:** Save status indicators (saved/unsaved changes)
3. **Project Navigation:** Users can browse projects and navigate to detailed views
4. **Note Management:** Users can create, edit, and organize notes within projects
5. **Language Switching:** Users can toggle between English and Farsi with proper text direction
6. **Responsive Design:** Mobile-friendly interface across all screens
7. **Tab Persistence:** Tab content and structure preserved across sessions

### ğŸ”„ In Progress

1. **Media Upload:** Backend integration for actual file uploads to Supabase Storage
2. **Note Deletion:** UI and API for removing notes
3. **Search Functionality:** Find notes across projects
4. **MCP Integration:** ChatGPT synthesis capabilities

---

## 4. Current Implementation Scope

### âœ… Implemented
- **Project CRUD:** Complete create, read operations with backend API
- **Tabbed Note Editor:** Full tabbed interface with auto-save
- **Tab Management:** Add/delete custom tabs, default tab structure
- **Auto-Save System:** Debounced content persistence with visual feedback
- **Bilingual Interface:** English/Farsi support with dynamic text direction
- **Database Schema:** Projects and notes tables with JSON tab storage
- **Responsive UI:** Mobile-first design with shadcn/ui components
- **Tab Structure:** Organized content with Finding/Evidence/Details tabs

### ğŸ”„ Partially Implemented
- **Media Attachments:** UI components ready, backend storage integration pending
- **Project Management:** Basic CRUD, advanced features (delete, archive) pending

### â³ Future Scope
- **MCP Server:** ChatGPT integration for research synthesis
- **Advanced Search:** Full-text search across notes and tabs
- **Export Features:** PDF, markdown, JSON export capabilities
- **Collaboration:** Multi-user project sharing
- **Version History:** Note revision tracking
- **Tab Templates:** Predefined tab structures for different research types

---

## 5. Technical Architecture

### Frontend Stack
- **Next.js 15:** React framework with App Router
- **TypeScript:** Type-safe development
- **Tailwind CSS v4:** Modern styling framework
- **shadcn/ui:** Component library for consistent UI
- **React Context:** State management for locale and preferences

### Backend Stack
- **Express.js:** RESTful API server
- **Supabase:** PostgreSQL database with real-time capabilities
- **Node.js:** Server runtime environment

### Database Schema
```sql
-- Projects table
projects (
  id UUID PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- Notes table with tab structure
notes (
  id UUID PRIMARY KEY,
  project_id UUID REFERENCES projects(id),
  title VARCHAR(200) DEFAULT 'Untitled Note',
  content TEXT, -- Legacy field for backward compatibility
  tabs JSONB, -- New tab structure storage
  active_tab VARCHAR(50) DEFAULT 'finding',
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

### Tab Structure
```typescript
interface NoteTab {
  content: string
  order: number
  created_at: string
}

interface NoteTabs {
  [tabName: string]: NoteTab
}

// Default tab structure
const defaultTabs: NoteTabs = {
  finding: {
    content: '',
    order: 1,
    created_at: new Date().toISOString()
  },
  evidence: {
    content: '',
    order: 2,
    created_at: new Date().toISOString()
  },
  details: {
    content: '',
    order: 3,
    created_at: new Date().toISOString()
  }
};
```

### API Endpoints
- `GET /api/projects` - List all projects
- `POST /api/projects` - Create new project
- `GET /api/projects/:id` - Get project details
- `GET /api/projects/:id/notes` - List project notes
- `POST /api/projects/:id/notes` - Create new note with tabs
- `PUT /api/notes/:id` - Update existing note tabs
- `DELETE /api/notes/:id` - Delete note

---

## 6. User Interface Design

### Key Design Decisions
1. **Tabbed Interface:** Structured content organization with Finding/Evidence/Details tabs
2. **Auto-Save Indicators:** Visual feedback for save status without manual save button
3. **Sidebar Navigation:** Project notes listed in collapsible sidebar
4. **Inline Editing:** Direct content editing in textarea fields
5. **Tab Management:** Add/delete custom tabs with intuitive controls
6. **Bilingual Support:** Seamless language switching with proper text direction

### Component Architecture
- **TabbedEditor:** Core multi-tab component with auto-save functionality
- **ProjectDetailPage:** Main interface with sidebar and tabbed editor
- **CreateProjectDialog:** Modal for new project creation
- **LocaleContext:** Global language and direction management
- **LanguageSwitcher:** Toggle between English and Farsi

### Tab Interface Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tab Navigation                                          â”‚
â”‚ [Finding] [Evidence] [Details] [+ Add Tab]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content Area                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Finding Content (textarea)                          â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â”‚                                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: â€¢ Saved (or â€¢ Unsaved changes)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Key Technical Decisions

### Tabbed Editor Implementation
- **Approach:** Multiple textarea fields with tab navigation
- **Rationale:** Simpler than rich text editor, better for structured research notes
- **Content Storage:** JSON structure in database JSONB fields
- **Auto-Save:** 2-second debounced saving with visual feedback

### Auto-Save Strategy
- **Triggers:** Input events with 2-second debouncing
- **Visual Feedback:** Orange dot for unsaved changes, green dot for saved
- **Error Handling:** Graceful error handling with console logging
- **Performance:** Prevents excessive API calls during typing

### Tab Management
- **Default Tabs:** Finding, Evidence, Details (non-deletable)
- **Custom Tabs:** User-defined tabs with add/delete functionality
- **Tab Ordering:** Order-based sorting with automatic reordering
- **Tab Persistence:** Tab structure preserved in database

---

## 8. Success Metrics (Planned)

### User Engagement
- Projects created per user
- Notes created per project
- Tabs created per note
- Session duration in editor
- Return usage frequency

### Technical Performance
- Auto-save response time (<500ms)
- Page load performance (Core Web Vitals)
- Tab switching performance
- Cross-browser compatibility scores

### Feature Adoption
- Tab usage patterns (default vs custom tabs)
- Language switching frequency
- Auto-save reliability
- Mobile vs desktop usage patterns

---

## 9. Future Roadmap

### Phase 1: Core Completion (Current)
- Complete media upload functionality
- Add note deletion capabilities
- Implement basic search across tabs

### Phase 2: MCP Integration
- Build MCP server for ChatGPT communication
- Create synthesis workflow UI
- Add export capabilities for synthesis results

### Phase 3: Advanced Features
- Advanced search and filtering across tabs
- Tab templates and snippets
- Collaboration features
- Version history and backups

### Phase 4: Scale & Polish
- Performance optimizations
- Advanced tab management features
- Integration with external research tools
- Mobile app considerations

---

## 10. Technical Debt & Known Issues

### Resolved Issues
- âœ… Auto-save implementation with proper debouncing
- âœ… Tab structure persistence in database
- âœ… Multiple note creation bug fixed
- âœ… Save button removal completed
- âœ… Text direction problems in tabbed interface

### Current Technical Debt
- Media insertion buttons are placeholder (no actual upload)
- Limited error handling in some edge cases
- No note deletion functionality in UI
- Basic validation, could be more comprehensive

### Future Considerations
- Consider migration to more robust rich text library if complexity grows
- Implement proper content sanitization for security
- Add offline capabilities for mobile usage
- Consider real-time collaboration features

---

## 11. Auto-Save Implementation Details

### Debounced Auto-Save Pattern
```typescript
const handleTabContentChange = (tabName: string, content: string) => {
  setTabs(prev => ({
    ...prev,
    [tabName]: {
      ...prev[tabName],
      content
    }
  }));
  setHasChanges(true);

  // Clear existing timeout and set new one
  if (saveTimeoutRef.current) {
    clearTimeout(saveTimeoutRef.current);
  }
  
  saveTimeoutRef.current = setTimeout(() => {
    handleSave();
  }, 2000);
};
```

### Save Status Indicators
- **Unsaved Changes:** Orange dot with "Unsaved changes" text
- **Saved:** Green dot with "Saved" text
- **No Save Button:** Completely removed for clean interface

### Error Handling
- Graceful error handling with console logging
- User-friendly error messages
- Retry mechanisms for failed saves

---

*This PRD reflects the current TabbedEditor implementation with auto-save functionality as of January 16, 2025, and will be updated as development progresses.*
